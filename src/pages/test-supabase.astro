---
import { supabase } from '../lib/supabase';
import Layout from '../layouts/Layout.astro';

let connectionStatus = 'üü° Pendiente...';
let authStatus = 'üü° Pendiente...';

// --- Test de Conexi√≥n a la Base de Datos ---
try {
  // El prefijo `_` en `_data` le dice a TypeScript que es normal que no se use.
  const { data: _data, error } = await supabase.from('_dummy_table').select('*').limit(1);
  
  if (error) {
    // Si Supabase devuelve un error, lo lanzamos para que sea capturado por el catch.
    throw error;
  }

  connectionStatus = '‚úÖ Conexi√≥n a la base de datos exitosa.';
} catch (error) {
  // Hacemos una comprobaci√≥n para asegurarnos de que `error` es un objeto Error.
  if (error instanceof Error) {
    connectionStatus = `‚ùå Error cr√≠tico: ${error.message}`;
  } else {
    connectionStatus = '‚ùå Error cr√≠tico: Ocurri√≥ un error desconocido.';
  }
}

// --- Test de Autenticaci√≥n ---
try {
  const { data: { user: _user }, error } = await supabase.auth.getUser();
  if (error) throw error;
  authStatus = '‚úÖ La autenticaci√≥n funciona correctamente.';
} catch (error) {
  if (error instanceof Error) {
    authStatus = `‚ùå Error de autenticaci√≥n: ${error.message}`;
  } else {
    authStatus = '‚ùå Error de autenticaci√≥n: Ocurri√≥ un error desconocido.';
  }
}
---
<Layout title="Test de Supabase">
  <h1 class="text-2xl font-bold mb-4">Resultados de la prueba de Supabase</h1>
  <p><strong>Conexi√≥n:</strong> {connectionStatus}</p>
  <p><strong>Autenticaci√≥n:</strong> {authStatus}</p>
</Layout>